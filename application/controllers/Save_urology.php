<?php defined('BASEPATH')OR exit('No direct script access allowed');class Save_urology extends CI_Controller{public function __construct(){parent::__construct();$this->load->model('model_admin');$this->load->library('form_validation');}function saveFields(){if($this->input->post('enf_motivo')==""){$response['message']="CAMPO REQUERIDO <br/>Enfemedad Actual: El Motivo de consulta es obligatorio. <span style='color:red;font-size:19px'>*</span>";$response['status']=1;}elseif($this->input->post('enf_signopsis')==""){$response['message']="CAMPO REQUERIDO <br/> Enfemedad Actual: El Signopsis es obligatorio. <span style='color:red;font-size:19px'>*</span>";$response['status']=2;}elseif($this->input->post('otros_diagnos')==""&&$this->input->post('cied')==""){$response['message']="CAMPO REQUERIDO <br/> Conclusi贸n Diagn贸stica: Marque una en la lista del CE10 o crear nueva. <span style='color:red;font-size:19px'>*</span>";$response['status']=4;}elseif($this->input->post('plan')==""){$response['message']="CAMPO REQUERIDO <br/> Conclusi贸n Diagn贸stica: El plan es obligatorio. <span style='color:red;font-size:19px'>*</span>";$response['status']=3;}else{$response['message']="";$response['status']=0;$insert_date=date("Y-m-d H:i:s");$user_id=$this->input->post('user_id');$idenfact=$this->session->userdata['update_enf_act'];$upEnf=array('enf_motivo'=>$this->input->post('enf_motivo'),'signopsis'=>$this->input->post('enf_signopsis'),'laboratorios'=>$this->input->post('enf_laboratorios'),'estudios'=>$this->input->post('enf_estudios'));$whereEnf=array('id_enf'=>$idenfact);$this->db->where($whereEnf);$this->db->update("h_c_sinopsis",$upEnf);$whereimg=array('id_patient'=>$this->input->post('hist_id'),'userid'=>$this->input->post('user_id'),'id_enfermedad'=>0);$updimg=array('id_enfermedad'=>$idenfact);$this->db->where($whereimg);$this->db->update("saveEnfImage",$updimg);$query1=$this->db->get_where('type_reasons',array('title'=>$this->input->post('enf_motivo')));if($query1->num_rows()==0){$save=array('title'=>$this->input->post('enf_motivo'),'inserted_by'=>$this->input->post('user_id'),'inserted_time'=>$insert_date,'updated_by'=>$this->input->post('user_id'),'updated_time'=>$insert_date);$this->model_admin->save_new_causa($save);}$uro_sin_ha_1=$this->input->post('uro_sin_ha_1');$uro_sin_ha_11=(isset($uro_sin_ha_1))?1:0;$uro_ant_escl=$this->input->post('uro_ant_escl');$uro_ant_escl1=(isset($uro_ant_escl))?1:0;$uro_ant_imp=$this->input->post('uro_ant_imp');$uro_ant_imp1=(isset($uro_ant_imp))?1:0;$uro_ant_ane_fal=$this->input->post('uro_ant_ane_fal');$uro_ant_ane_fal1=(isset($uro_ant_ane_fal))?1:0;$uro_ant_vari=$this->input->post('uro_ant_vari');$uro_ant_vari1=(isset($uro_ant_vari))?1:0;$uro_ant_fimosis=$this->input->post('uro_ant_fimosis');$uro_ant_fimosis1=(isset($uro_ant_fimosis))?1:0;$uro_ant_hid=$this->input->post('uro_ant_hid');$uro_ant_hid1=(isset($uro_ant_hid))?1:0;$uro_sin_ha_2=$this->input->post('uro_sin_ha_2');$uro_sin_ha_21=(isset($uro_sin_ha_2))?1:0;$uro_ant_cancer_prostata=$this->input->post('uro_ant_cancer_prostata');$uro_ant_cancer_prostata1=(isset($uro_ant_cancer_prostata))?1:0;$uro_ant_poli_renal=$this->input->post('uro_ant_poli_renal');$uro_ant_poli_renal1=(isset($uro_ant_poli_renal))?1:0;$uro_ant_uroli=$this->input->post('uro_ant_uroli');$uro_ant_uroli1=(isset($uro_ant_uroli))?1:0;$uro_ant_cist=$this->input->post('uro_ant_cist');$uro_ant_cist1=(isset($uro_ant_cist))?1:0;$ants=array('uro_sin_ha_1'=>$uro_sin_ha_11,'uro_ant_escl'=>$uro_ant_escl1,'uro_ant_imp'=>$uro_ant_imp1,'uro_ant_ane_fal'=>$uro_ant_ane_fal1,'uro_ant_vari'=>$uro_ant_vari1,'uro_ant_fimosis'=>$uro_ant_fimosis1,'uro_ant_hid'=>$uro_ant_hid1,'uro_ant_its'=>$this->input->post('uro_ant_its'),'uro_ant_tumorales'=>$this->input->post('uro_ant_tumorales'),'uro_ant_otros'=>$this->input->post('uro_ant_otros'),'uro_sin_ha_2'=>$uro_sin_ha_21,'uro_ant_cancer_prostata'=>$uro_ant_cancer_prostata1,'uro_ant_poli_renal'=>$uro_ant_poli_renal1,'uro_ant_uroli'=>$uro_ant_uroli1,'uro_ant_cist'=>$uro_ant_cist1,'uro_ant_otros2'=>$this->input->post('uro_ant_otros2'),'id_patient'=>$this->input->post('hist_id'),'inserted_by'=>$this->input->post('user_id'),'updated_by'=>$this->input->post('user_id'),'inserted_time'=>$insert_date,'updated_time'=>$insert_date,'id_centro'=>$this->input->post('centro_medico'),);$this->db->insert("h_c_urology_antecedentes",$ants);$save2=array('maltratof'=>$this->input->post('textmaltrato_g'),'abusos'=>$this->input->post('textabuso_g'),'negligencia'=>$this->input->post('textneg_g'),'maltrato'=>$this->input->post('maltratoemo_g'),'alimentos'=>$this->input->post('alimentos_al'),'medicamentos'=>$this->input->post('medicamentos_al'),'otros'=>$this->input->post('otros_al'),'historial_id'=>$this->input->post('hist_id'),'date_insert'=>$insert_date,'update_time'=>$insert_date,'inserted_by'=>$this->input->post('user_id'),'update_by'=>$this->input->post('user_id'));$idDes=$this->model_admin->DesantAl($save2);$counDesa=$this->model_admin->countDesarollo($this->input->post('hist_id'));if($counDesa>1){$this->model_admin->DeleteEmptyDesarollo($idDes);}$save3=array('quirurgicos'=>$this->input->post('quirurgicos'),'gineco'=>$this->input->post('gineco'),'abdominal'=>$this->input->post('abdominal'),'toracica'=>$this->input->post('toracica'),'transfusion'=>$this->input->post('transfusion'),'otros1'=>$this->input->post('otros1_g'),'hepatis'=>$this->input->post('hepatis'),'hpv'=>$this->input->post('hpv'),'toxoide'=>$this->input->post('toxoide'),'grouposang'=>$this->input->post('grouposang'),'tipificacion'=>$this->input->post('tipificacion'),'rh'=>$this->input->post('rhoa'),'violencia1'=>$this->input->post('violencia1'),'violencia2'=>$this->input->post('violencia2'),'violencia3'=>$this->input->post('violencia3'),'violencia4'=>$this->input->post('violencia4'),'historial_id'=>$this->input->post('hist_id'),'inserted_time'=>$insert_date,'inserted_by'=>$this->input->post('user_id'));$idAtO=$this->model_admin->saveAnteOtros($save3);$counAntOt=$this->model_admin->countAntOtros($this->input->post('hist_id'));if($counAntOt>1){$this->model_admin->DeleteAntOtros($idAtO);}if(!empty($medicine)){foreach($medicine as $med){$save=array('medicine'=>$med,'id_patient'=>$this->input->post('hist_id'),'user_id'=>$this->input->post('user_id'));$this->model_admin->SaveMedicine($save);};};$this->model_admin->deleteMedNinguno();$hab_t_drug=$this->input->post('hab_t_drug');$save4=array('cafe_cant'=>$this->input->post('hab_c_caf'),'cafe_frec'=>$this->input->post('hab_f_caf'),'pipa_cant'=>$this->input->post('hab_c_pip'),'pipa_frec'=>$this->input->post('hab_f_pip'),'ciga_can'=>$this->input->post('hab_c_ciga'),'ciga_frec'=>$this->input->post('hab_f_ciga'),'alc_can'=>$this->input->post('hab_c_al'),'alc_frec'=>$this->input->post('hab_f_al'),'tab_can'=>$this->input->post('hab_c_tab'),'tab_frec'=>$this->input->post('hab_f_tab'),'hab_c_drug'=>$this->input->post('hab_c_drug'),'hab_f_drug'=>$this->input->post('hab_f_drug'),'cafe_cant_desc'=>$this->input->post('cafe_cant_desc'),'pipa_cant_desc'=>$this->input->post('pipa_cant_desc'),'ciga_can_desc'=>$this->input->post('ciga_can_desc'),'alc_can_desc'=>$this->input->post('alc_can_desc'),'tab_can_desc'=>$this->input->post('tab_can_desc'),'hookah_desc'=>$this->input->post('hookah_desc'),'hab_c_drug_desc'=>$this->input->post('hab_c_drug_desc'),'hookah'=>$this->input->post('hookah'),'hab_f_hookah'=>$this->input->post('hab_f_hookah'),'historial_id'=>$this->input->post('hist_id'),'inserted_by'=>$this->input->post('user_id'),'inserted_time'=>$insert_date,'update_time'=>$insert_date);$idHabT=$this->model_admin->saveHabitosToxicos($save4);$counHabT=$this->model_admin->countHabitosToxicos($this->input->post('hist_id'));if($counHabT>1){$this->model_admin->DeleteEmptyHabitosToxicos($idHabT);}if(!empty($hab_t_drug)){foreach($hab_t_drug as $drug){$save=array('name'=>$drug,'id_patient'=>$this->input->post('hist_id'));$this->model_admin->SaveDrug($save);};}$uro_tacto_rectal_done=$this->input->post('uro_tacto_rectal_done');$uro_tacto_rectal_done1=(isset($uro_tacto_rectal_done))?1:0;$exams=array('uro_pene'=>$this->input->post('uro_pene'),'uro_testicule'=>$this->input->post('uro_testicule'),'uro_epididimos'=>$this->input->post('uro_epididimos'),'uro_tacto_rectal_done'=>$uro_tacto_rectal_done1,'uro_tato_rec_pros'=>$this->input->post('uro_tato_rec_pros'),'uro_geni_mujer'=>$this->input->post('uro_geni_mujer'),'uro_vejiga'=>$this->input->post('uro_vejiga'),'uro_loins'=>$this->input->post('uro_loins'),'uro_otros'=>$this->input->post('uro_otros'),'peso'=>$this->input->post('peso'),'kg'=>$this->input->post('kg'),'talla'=>$this->input->post('talla'),'pulgada_exf'=>$this->input->post('pulgada'),'imc'=>$this->input->post('imc'),'ta'=>$this->input->post('ta'),'fr'=>$this->input->post('fr'),'fc'=>$this->input->post('fc'),'hg'=>$this->input->post('hg'),'tempo'=>$this->input->post('tempo'),'pulso'=>$this->input->post('pulso'),'glicemia'=>$this->input->post('glicemia'),'radio'=>$this->input->post('radio_signo'),'id_patient'=>$this->input->post('hist_id'),'inserted_by'=>$this->input->post('user_id'),'updated_by'=>$this->input->post('user_id'),'inserted_time'=>$insert_date,'updated_time'=>$insert_date,'id_centro'=>$this->input->post('centro_medico'),);$this->db->insert("h_c_urology",$exams);$id_last=$this->db->insert_id();$examFisUro=$this->db->select('*')->where('id',$id_last)->get('h_c_urology')->row_array();if($examFisUro['uro_pene']==0&&$examFisUro['uro_testicule']==0&&$examFisUro['uro_epididimos']==''&&$examFisUro['uro_tato_rec_pros']==''&&$examFisUro['uro_geni_mujer']==''&&$examFisUro['uro_vejiga']==''&&$examFisUro['uro_loins']==''&&$examFisUro['peso']==0&&$examFisUro['kg']==0&&$examFisUro['talla']==''&&$examFisUro['imc']==''&&$examFisUro['ta']==''&&$examFisUro['fr']==''&&$examFisUro['fc']==''&&$examFisUro['hg']==''&&$examFisUro['tempo']==''&&$examFisUro['pulso']==''&&$examFisUro['glicemia']==''){$whereot=array('id'=>$id_last);$this->db->where($whereot);$this->db->delete('h_c_urology');}}echo json_encode($response);}function updateUrology(){$id=$this->input->post('id');$id_sig=$this->input->post('id_sig');$insert_date=date("Y-m-d H:i:s");$uro_tacto_rectal_done=$this->input->post('uro_tacto_rectal_done');$uro_tacto_rectal_done1=(isset($uro_tacto_rectal_done))?1:0;$data=array('uro_pene'=>$this->input->post('uro_pene'),'uro_testicule'=>$this->input->post('uro_testicule'),'uro_epididimos'=>$this->input->post('uro_epididimos'),'uro_tacto_rectal_done'=>$uro_tacto_rectal_done1,'uro_tato_rec_pros'=>$this->input->post('uro_tato_rec_pros'),'uro_geni_mujer'=>$this->input->post('uro_geni_mujer'),'uro_vejiga'=>$this->input->post('uro_vejiga'),'uro_loins'=>$this->input->post('uro_loins'),'uro_otros'=>$this->input->post('uro_otros'),'peso'=>$this->input->post('peso'),'kg'=>$this->input->post('kg'),'talla'=>$this->input->post('talla'),'pulgada_exf'=>$this->input->post('pulgada'),'imc'=>$this->input->post('imc'),'ta'=>$this->input->post('ta'),'fr'=>$this->input->post('fr'),'fc'=>$this->input->post('fc'),'hg'=>$this->input->post('hg'),'tempo'=>$this->input->post('tempo'),'glicemia'=>$this->input->post('glicemiae'),'pulso'=>$this->input->post('pulso'),'radio'=>$this->input->post('radio_signo'),'updated_by'=>$this->input->post('id_user'),'updated_time'=>$insert_date);$where=array('id'=>$id);$this->db->where($where);$result=$this->db->update("h_c_urology",$data);if($result){$response['status']=1;$response['message']='<div class="alert alert-success">Cambio Hecho!</div>';}else{$response['status']=0;$response['message']='<div class="alert alert-danger">Cambio Fallo!</div>!';}echo json_encode($response);}function updateAntecedentes(){$insert_date=date("Y-m-d H:i:s");$hist_id=$this->input->post('hist_id');$uro_sin_ha_1=$this->input->post('uro_sin_ha_1');$uro_sin_ha_11=(isset($uro_sin_ha_1))?1:0;$uro_ant_escl=$this->input->post('uro_ant_escl');$uro_ant_escl1=(isset($uro_ant_escl))?1:0;$uro_ant_imp=$this->input->post('uro_ant_imp');$uro_ant_imp1=(isset($uro_ant_imp))?1:0;$uro_ant_ane_fal=$this->input->post('uro_ant_ane_fal');$uro_ant_ane_fal1=(isset($uro_ant_ane_fal))?1:0;$uro_ant_vari=$this->input->post('uro_ant_vari');$uro_ant_vari1=(isset($uro_ant_vari))?1:0;$uro_ant_fimosis=$this->input->post('uro_ant_fimosis');$uro_ant_fimosis1=(isset($uro_ant_fimosis))?1:0;$uro_ant_hid=$this->input->post('uro_ant_hid');$uro_ant_hid1=(isset($uro_ant_hid))?1:0;$uro_sin_ha_2=$this->input->post('uro_sin_ha_2');$uro_sin_ha_21=(isset($uro_sin_ha_2))?1:0;$uro_ant_cancer_prostata=$this->input->post('uro_ant_cancer_prostata');$uro_ant_cancer_prostata1=(isset($uro_ant_cancer_prostata))?1:0;$uro_ant_poli_renal=$this->input->post('uro_ant_poli_renal');$uro_ant_poli_renal1=(isset($uro_ant_poli_renal))?1:0;$uro_ant_uroli=$this->input->post('uro_ant_uroli');$uro_ant_uroli1=(isset($uro_ant_uroli))?1:0;$uro_ant_cist=$this->input->post('uro_ant_cist');$uro_ant_cist1=(isset($uro_ant_cist))?1:0;$data=array('uro_sin_ha_1'=>$uro_sin_ha_11,'uro_ant_escl'=>$uro_ant_escl1,'uro_ant_imp'=>$uro_ant_imp1,'uro_ant_ane_fal'=>$uro_ant_ane_fal1,'uro_ant_vari'=>$uro_ant_vari1,'uro_ant_fimosis'=>$uro_ant_fimosis1,'uro_ant_hid'=>$uro_ant_hid1,'uro_ant_its'=>$this->input->post('uro_ant_its'),'uro_ant_tumorales'=>$this->input->post('uro_ant_tumorales'),'uro_ant_otros'=>$this->input->post('uro_ant_otros'),'uro_sin_ha_2'=>$uro_sin_ha_21,'uro_ant_cancer_prostata'=>$uro_ant_cancer_prostata1,'uro_ant_poli_renal'=>$uro_ant_poli_renal1,'uro_ant_uroli'=>$uro_ant_uroli1,'uro_ant_cist'=>$uro_ant_cist1,'uro_ant_otros2'=>$this->input->post('uro_ant_otros2'),'updated_by'=>$this->input->post('id_user'),'updated_time'=>$insert_date);$where=array('id'=>$this->input->post('id'));$this->db->where($where);$result=$this->db->update("h_c_urology_antecedentes",$data);if($result){$response['status']=1;$response['message']='<div class="alert alert-success">Cambio Hecho!</div>';}else{$response['status']=0;$response['message']='<div class="alert alert-danger">Cambio Fallo!</div>!';}echo json_encode($response);$save_ant_al=array('medicamentos'=>$this->input->post('medicamentos_al'),'alimentos'=>$this->input->post('alimentos_al'),'otros'=>$this->input->post('otros_al'),'update_by'=>$this->input->post('id_user'),'update_time'=>$insert_date);$this->model_admin->updateAntAl($hist_id,$save_ant_al);$saveAntO=array('quirurgicos'=>$this->input->post('quirurgicos'),'gineco'=>$this->input->post('gineco'),'abdominal'=>$this->input->post('abdominal'),'toracica'=>$this->input->post('toracica'),'transfusion'=>$this->input->post('transfusion'),'otros1'=>$this->input->post('otros1'),'hepatis'=>$this->input->post('hepatis'),'hpv'=>$this->input->post('hpv'),'toxoide'=>$this->input->post('toxoide'),'grouposang'=>$this->input->post('grouposang'),'tipificacion'=>$this->input->post('tipificacion'),'rh'=>$this->input->post('rh'),'update_by'=>$this->input->post('id_user'),'update_time'=>$insert_date);$this->model_admin->updateAnteOtros($hist_id,$saveAntO);$hab_t_drug=$this->input->post('hab_t_drug');$save_ht=array('cafe_cant'=>$this->input->post('hab_c_caf'),'cafe_frec'=>$this->input->post('hab_f_caf'),'pipa_cant'=>$this->input->post('hab_c_pip'),'pipa_frec'=>$this->input->post('hab_f_pip'),'ciga_can'=>$this->input->post('hab_c_ciga'),'ciga_frec'=>$this->input->post('hab_f_ciga'),'alc_can'=>$this->input->post('hab_c_al'),'alc_frec'=>$this->input->post('hab_f_al'),'tab_can'=>$this->input->post('hab_c_tab'),'tab_frec'=>$this->input->post('hab_f_tab'),'hookah'=>$this->input->post('hookah'),'hab_f_hookah'=>$this->input->post('hab_f_hookah'),'hab_c_drug'=>$this->input->post('hab_c_drug'),'hab_f_drug'=>$this->input->post('hab_f_drug'),'cafe_cant_desc'=>$this->input->post('cafe_cant_desc'),'pipa_cant_desc'=>$this->input->post('pipa_cant_desc'),'ciga_can_desc'=>$this->input->post('ciga_can_desc'),'alc_can_desc'=>$this->input->post('alc_can_desc'),'tab_can_desc'=>$this->input->post('tab_can_desc'),'hookah_desc'=>$this->input->post('hookah_desc'),'hab_c_drug_desc'=>$this->input->post('hab_c_drug_desc'),'update_by'=>$this->input->post('id_user'),'update_time'=>$insert_date);$this->model_admin->updateHabitosToxicos($hist_id,$save_ht);$this->model_admin->deleteDrug($hist_id);if(!empty($hab_t_drug)){foreach($hab_t_drug as $drug){$saveDg=array('name'=>$drug,'id_patient'=>$hist_id);$this->model_admin->SaveDrug($saveDg);};}$this->model_admin->deleteNingunoDroga();}}