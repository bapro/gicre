<style>td,th{text-align:left}.fa.fa-check,.fa.fa-history,em{color:red;font-size:11px;text-transform:lowercase}</style><?php if($perfil=='Medico'&&$area_id==0){redirect("medico/update_user");}$this->padron_database=$this->load->database('padron',TRUE);if($perfil=="Admin"){$controller="admin";}else{$controller="medico";}$today=date('Y-m-d'); ?><div class="col-md-12"><div class="row"><a class="btn btn-primary btn-xs"href="<?php echo site_url("$controller/create_cita"); ?>">Buscar/Crear Paciente</a></div></div><div class="col-md-12"><div class="row"><div style="display:<?=$displayTotInfo?>"><select class="form-control select2"style="background:#e0e5e6;width:100%"id="by-doctor"><option value="0"><?=$countTotalCitaDocNum?></option><?php foreach($countTotalCitaDoc as $rowtd){$doctot=$this->db->select('name')->where('id_user',$rowtd->doctor)->get('users')->row('name');echo '<option value="'.$rowtd->doctor.'">Dr '.$doctot.' : '.$rowtd->Total.' cita(s) </option>';}echo "</select>";echo "<br/>";echo "</div>"; echo "<h4>Buscar Citas Previas</h4>"; if($perfil=="Asistente Medico"){ ?><form action="<?php echo site_url("$controller/SeachCitaResultAs"); ?>"class="form-inline"><div class="col-md-3"><select class="form-control select2"style="background:#e0e5e6;width:100%"id="doctor"name="doctor"><option value="">Seleccione un medico</option><?php $sql="SELECT id_doctor FROM centro_doc_as WHERE id_asdoc =$iduser group by id_doctor";$query=$this->db->query($sql);foreach($query->result()as $row){$name=$this->db->select('name')->where('id_user',$row->id_doctor)->get('users')->row('name');echo '<option value="'.$row->id_doctor.'">Dr '.$name.'</option>';} ?></select></div><?php }else{ ?><form action="<?php echo site_url("$controller/SeachCitaResult"); ?>"class="form-inline"><div class="col-md-3"><select class="form-control select2"style="background:#e0e5e6;width:100%"name="centro"><?php foreach($centro_medico as $row){echo '<option value="'.$row->id_m_c.'">'.$row->name.'</option>';} ?></select></div><?php } ?><div class="col-md-9"style="background:#e0e5e6;border:1px solid #38a7bb"><div class="form-group"><label for="desde"style="font-size:10px">Desde</label><input class="form-control"id="date_from"name="date_from"readonly value="<?=date('d-m-Y')?>"></div><div class="form-group"><label for="hasta"style="font-size:10px">Hasta</label><input class="form-control"id="date_to"name="date_to"readonly value="<?=date('d-m-Y')?>"></div><button class="btn btn-primary btn-xs"disabled id="click_button"type="submit"><i class="fa fa-search"></i></button><?php if($perfil=="Asistente Medico"){}else{if($appointments!=NULL){ ?><a class="btn-sm"href="<?php echo base_url("printings/print_hoy_cita1/$iduser/$perfil") ?>"target="_blank"title="Imprimir Las Citas de Hoy"><i class="fa"style="font-size:24px"></i></a><?php }} ?></div></form><span id="flash1"></span></div><br/><div class="row"id="dis"><h4>Citas Por Hoy</h4><div class="row"><div class="col-md-4"><select class="form-control select2"style="background:#e0e5e6;width:100%"id="search-hoy-patient"><option value="">Filtrar Cita Por Paciente</option><?php foreach($patientHoyQ as $pathoy){$patienthoy=$this->db->select('nombre')->where('id_p_a',$pathoy->id_patient)->get('patients_appointments')->row('nombre');echo '<option value="'.$pathoy->id_patient.'">'.$patienthoy.'</option>';} ?></select></div><div class="col-md-4"><select class="form-control select2"id="search-hoy-centro"style="background:#e0e5e6;width:100%"><option value="">Filtrar Cita Por Centro Médico</option><?php foreach($centro_medico as $row){echo '<option value="'.$row->id_m_c.'">'.$row->name.'</option>';} ?></select></div><div class="col-md-4"><a href="#" onClick="window.location.reload();return false;" class="btn btn-primary btn-xs">Listar Todos</a></div></div><div style="overflow-x:auto"><hr/><div id="load-citas-hoy"><?php $this->load->view('medico/refreshCitaHoy'); ?><div class="pagination"style="float:right"><?php echo $links; ?></div></div></div></div><br><br></div><br></div><?php $this->load->view('footer'); ?><div class="fade modal"id="EditC"role="dialog"><div class="modal-dialog modal-md"><div class="modal-content"><div class="modal-body"></div></div></div></div><script src="https://code.jquery.com/jquery-2.1.1.min.js"></script><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/js/select2.min.js"></script><script src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script><script src="https://cdn.datatables.net/1.10.16/js/dataTables.bootstrap.min.js"></script><script src="//code.jquery.com/ui/1.11.3/jquery-ui.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.min.js"></script><script src="https://momentjs.com/downloads/moment-with-locales.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.47/js/bootstrap-datetimepicker.min.js"></script><script src="<?=base_url()?>assets/js/custom.js"></script><script type="text/javascript">function disabledserach(){var t=new Date,o=t.getMonth()+1,a=t.getDate(),e=((""+a).length<2?"0":"")+a+"-"+((""+o).length<2?"0":"")+o+"-"+t.getFullYear();$("#date_from").val()==e&&$("#date_to").val()==e?$("#click_button").prop("disabled",!0):$("#click_button").prop("disabled",!1)}$("#EditC").on("hidden.bs.modal",function(){$(this).removeData("bs.modal")}),$(".cancelar-cita").click(function(){if(confirm("¿Estás seguro de cancelar esta cita?")){var o=this,t=$(this).attr("id");$.ajax({type:"POST",url:"<?=base_url('cita/cancelCita')?>",data:{id:t,iduser:<?=$iduser?>},success:function(t){$(o).closest("tr").css("background","tomato"),$(o).closest("tr").fadeOut(800,function(){$(this).remove()})}})}}),$("#doctor").on("change",function(){$("#load-citas-hoy").html('<span style="text-align:center"> <img   src="<?=base_url()?>assets/img/loading.gif" /> cargando las citas...</span>');var t=$(this).val();$.ajax({type:"POST",url:"<?=base_url('admin_medico/get_centro_cita_doc')?>",data:{iduser:<?=$iduser?>,id_doc:t},success:function(t){$("#load-citas-hoy").html(t)}})}),$("#by-doctor").on("change",function(){$("#load-citas-hoy").html('<span style="text-align:center"> <img   src="<?=base_url()?>assets/img/loading.gif" /> cargando las citas...</span>');var t=$(this).val();0!=t?$.ajax({type:"POST",url:"<?=base_url('admin/getConfirmSolicitudByDoc')?>",data:{iduser:<?=$iduser?>,id_doc:t},success:function(t){$("#load-citas-hoy").html(t)},error:function(t,o,a){alert("An erroroccurred... Look at the console (F12 or Ctrl+Shift+I, Console tab) for more information!"),$("#load-citas-hoy").html("<p>statuscode: "+t.status+"</p><p>errorThrown: "+a+"</p><p>jqXHR.responseText:</p><div>"+t.responseText+"</div>"),console.log("jqXHR:"),console.log(t),console.log("textStatus:"),console.log(o),console.log("errorThrown:"),console.log(a)}}):location.reload()}),$(".select2").select2({tags:!0,language:{noResults:function(){return"No hay resultado"}}}),$("#date_from").datepicker({dateFormat:"dd-mm-yy"}),$("#date_to").datepicker({onSelect:function(){disabledserach()},dateFormat:"dd-mm-yy"})</script><script>function filtrarCitaHoy(a,t){$("#load-citas-hoy").html('<span style="text-align:center"> <img   src="<?= base_url();?>assets/img/loading.gif" /> cargando las citas...</span>'),$.ajax({type:"POST",url:"<?=base_url('cita/filtrarCitaHoy')?>",data:{filtrar:a,campo:t,iduser:"<?=$iduser?>",perfil:"<?=$perfil?>",area_id:"<?=$area_id?>",controller:"<?=$controller?>"},success:function(a){$("#load-citas-hoy").html(a)}})}$("#search-hoy-patient").on("change",function(){filtrarCitaHoy($(this).val(),"id_patient")}),$("#search-hoy-centro").on("change",function(){filtrarCitaHoy($(this).val(),"centro")});</script>