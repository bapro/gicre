<?php $this->padron_database=$this->load->database('padron',TRUE);if($perfil=='Admin'){$controller="admin";$back='appointments';}else{$controller="medico";$back='index';}if($VER_CONFIRMADA_SOLICITUD!==null){ ?><div class="row"><a href="<?php echo site_url("$controller/$back"); ?>"class="btn btn-primary btn-xs">Citas de hoy</a><br><br><?php if($perfil=="Asistente Medico"){ ?><form action="<?php echo site_url("$controller/SeachCitaResultAs"); ?>"class="form-inline"><div class="col-md-3"><select class="form-control select2"name="doctor"style="background:#e0e5e6;width:100%"id="doctor"><?php $sql="SELECT id_doctor FROM centro_doc_as WHERE id_asdoc =$iduser group by id_doctor";$query=$this->db->query($sql);foreach($query->result()as $row){$idmed=$this->db->select('id_doctor')->where('id_doctor',$doctor)->get('centro_doc_as')->row('id_doctor');if($doctor==$row->id_doctor){$selected="selected";}else{$selected="";}$name=$this->db->select('name')->where('id_user',$row->id_doctor)->get('users')->row('name');echo"<option $selected value='$row->id_doctor'>Dr $name</option>";} ?></select></div><?php }else{ ?><form action="<?php echo site_url("$controller/SeachCitaResult"); ?>"class="form-inline"><div class="col-md-3"><select class="form-control select2"name="centro"style="background:#e0e5e6;width:100%"><?php foreach($centro_medico as $row){$centr=$this->db->select('id_m_c')->where('id_m_c',$row->id_m_c)->get('medical_centers')->row('id_m_c');if($centro==$centr){$selected="selected";}else{$selected="";}echo"<option value='$row->id_m_c.' $selected>$row->name</option>";} ?></select></div><?php } ?><div class="col-md-9"style="background:#e0e5e6;border:1px solid #38a7bb"><div class="form-group"><label for="desde"style="font-size:10px">Desde</label><input class="form-control"id="date_from"name="date_from"readonly value="<?=$date1?>"></div><div class="form-group"><label for="hasta"style="font-size:10px">Hasta</label><input class="form-control"id="date_to"name="date_to"readonly value="<?=$date2?>"></div><button class="btn btn-primary btn-xs"id="click_button"type="submit"><i class="fa fa-search"></i></button></div></form></div><hr id="hr_ad"><div class="row"><div style="overflow-x:auto"><div id="load-citas-hoy"><table class="table table-striped display<?=$exam?>"><thead><tr style="background:#5957f7;color:#fff"><th><strong>Foto</strong></th><th><strong>NEC</strong></th><th><strong>Paciente</strong></th><th><strong>Fecha Propuesta</strong></th><th><strong>Centro Medico</strong></th><th><strong>Doctor</strong></th><th><strong>Historial Medical</strong></th></tr></thead><tbody><?php $cpt="";foreach($VER_CONFIRMADA_SOLICITUD as $ver){$areaid= $this->db->select('area')->where('id_user',$ver->doctor)->get('users')->row('area');$areaIdH = encrypt_url($areaid);$id_p_a_h=encrypt_url($ver->id_patient);$id_user_h=encrypt_url($iduser);$id_cm_h=encrypt_url($ver->centro);$num1=encrypt_url(1);$num0=encrypt_url(0);$from_view=encrypt_url(1);$patient=$this->db->select('nombre,photo,ced1,ced2,ced3')->where('id_p_a',$ver->id_patient)->get('patients_appointments')->row_array();$insert_date=date("d-m-Y H:i:s",strtotime($ver->inserted_by));$q=$this->db->select('id_patient')->where('id_patient',$ver->id_patient)->where('doctor',$ver->doctor)->where('centro',$ver->centro)->get('rendez_vous');if($cpt==0){$cpt=1;$colorBg="#E0E5E6";}else{$cpt=0;$colorBg="#E0E5E6";}$sqlcita="SELECT id_rdv FROM factura2 where id_rdv=$ver->id_apoint";$cita_con=$this->db->query($sqlcita);if($cita_con->num_rows()>0){$cita='#9AFBBE';}else{$cita="";}$freq="SELECT historial_id FROM h_c_sinopsis where  historial_id=$ver->id_patient group by filter_date";$cita_freq=$this->db->query($freq);if($cita_freq->num_rows()==0){$frecuencia_text="";}else if($cita_freq->num_rows()==1){$frecuencia_text="$cita_freq->num_rows vista";}else{$frecuencia_text="$cita_freq->num_rows vistas";} ?><tr style="background:<?=$cita?>"><td><?php if($patient['photo']=="padron"){$photo=$this->padron_database->select('IMAGEN')->where('MUN_CED',$patient['ced1'])->where('SEQ_CED',$patient['ced2'])->where('VER_CED',$patient['ced3'])->get('fotos')->row('IMAGEN');echo '<img width="75" height="75"   src="data:image/jpeg;base64,'.base64_encode($photo).'" />';}else if($patient['photo']==""){ ?><img height="75"src="<?=base_url()?>/assets/img/user.png"width="75"><?php }else{ ?><img height="75"src="<?=base_url()?>/assets/img/patients-pictures/<?php echo $patient['photo']; ?>"width="75"><?php } ?></td><td class="id"><?=$ver->id_patient?></td><?php if($patient['nombre']){$pat_name=$patient['nombre'];$link_pat="$controller/patient";}else{$pat_name="Editar Paciente";$link_pat="utilitaire/edit_patient_cita";}?><td style="text-transform:uppercase"><a href="<?php echo site_url("$link_pat/$ver->id_patient/$ver->centro/$ver->doctor"); ?>"><?=$pat_name?></a></td><td class="fecha_propuesta"><?=$ver->fecha_propuesta?></td><td style="text-transform:uppercase"><?php $centro=$this->db->select('name,type')->where('id_m_c',$ver->centro)->get('medical_centers')->row_array(); ?><a href="<?php echo site_url("$controller/centro_medico/".$ver->centro); ?>"><?=$centro['name']?></a></td><td style="text-transform:uppercase"><?php $doctor=$this->db->select('name')->where('id_user',$ver->doctor)->get('users')->row('name');if($perfil=='Admin'){ ?><a href="<?php echo site_url("admin/doctor/".$ver->doctor); ?>"><?=$doctor?></a><?php }else{echo $doctor;} ?></td><td style="text-transform:uppercase"><?php if($perfil=="Admin"){ ?><a href="<?php echo site_url("$controller/historial_medical/$id_p_a_h/$id_user_h/$areaIdH/$id_cm_h/$num1/$id_user_h/$from_view"); ?>"><i class="fa fa-history"aria-hidden="true"style="font-size:11px"></i> <em style="font-size:11px;text-transform:lowercase;color:red"><?=$frecuencia_text?></em></a><?php }else if($perfil=="Medico"){ ?><a href="<?php echo site_url("$controller/historial_medical/$id_p_a_h/$id_user_h/$areaIdH/$id_cm_h/$num1/$id_user_h/$from_view"); ?>"><i class="fa fa-history"aria-hidden="true"style="font-size:11px"></i> <em style="font-size:11px;text-transform:lowercase;color:red"><?=$frecuencia_text?></em></a><?php }else if($perfil=="Asistente Medico"&&$centro['type'] !="publico"){;$num4=encrypt_url(4);$doctor_h=encrypt_url($ver->doctor); ?><a href="<?php echo site_url("$controller/historial_medical/$id_p_a_h/$doctor_h/$areaIdH/$id_cm_h/$num4/$id_user_h/$from_view"); ?>"><i class="fa fa-history"aria-hidden="true"style="font-size:11px"></i> <em style="font-size:11px;text-transform:lowercase;color:red"><?=$frecuencia_text?></em></a><?php }else{echo "<span style='color:red;font-size:15px'>No tiene acceso a la historia clinica</span>";} ?></td></tr><?php } ?></tbody></table></div><br><?php $sqlcita="SELECT medico FROM factura2 where medico=$iduser";$cita=$this->db->query($sqlcita);if($perfil=="Medico"){$wid="width:20%";$countcit=$cita->num_rows();if($countcit==0){$disp="none";}else{$disp="";}}else{$wid="width:18%";$countcit="";$disp="";} ?><br><br></div></div><?php }else{echo"<div class='alert alert-info'><center><strong>No hay citas que coincidan con el rango de fecha desde $date1 hasta $date2.</strong></center></div>";} ?></div><?php $this->load->view('footer'); ?><script src="https://code.jquery.com/jquery-2.1.1.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/js/select2.min.js"></script><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script><script src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script><script src="https://cdn.datatables.net/1.10.16/js/dataTables.bootstrap.min.js"></script><script src="//code.jquery.com/ui/1.11.3/jquery-ui.js"></script><script src="<?=base_url()?>assets/js/custom.js"></script><script>function disabledserach(){var e=new Date,t=e.getMonth()+1,a=e.getDate(),d=((""+a).length<2?"0":"")+a+"-"+((""+t).length<2?"0":"")+t+"-"+e.getFullYear();$("#date_from").val()==d&&$("#date_to").val()==d?$("#click_button").prop("disabled",!0):$("#click_button").prop("disabled",!1)}$(".select2").select2({tags:!0,language:{noResults:function(){return"No hay resultado"}}}),$(document).ready(function(){$(".<?=$exam?>").DataTable({language:{url:"//cdn.datatables.net/plug-ins/9dcbecd42ad/i18n/Spanish.json"},aaSorting:[[0,"desc"]]})}),$("#date_from").datepicker({dateFormat:"dd-mm-yy"}),$("#date_to").datepicker({onSelect:function(){disabledserach()},dateFormat:"dd-mm-yy"})</script>