<?php $medicamentos=$this->model_admin->medicamentos();$presentacion=$this->model_admin->Presentacion();$branches=$this->model_admin->branches();$via=$this->model_admin->via();$frecuencia=$this->model_admin->frecuencia();$per=$this->db->select('perfil')->where('id_user',$user_id)->get('users')->row('perfil');if($per=='Admin'){$querycentro=$this->account_demand_model->getCentroMedico();}else if($per=='Medico'){$querycentro=$this->model_medico->getMedicoCentro($user_id);}else{$querycentro=$this->model_admin->view_as_doctor_centro($user_id);} ?><div class="col-md-7"><label class="control-label"><span style="color:red">*</span> Centro Medico</label> <select class="form-control select2"id="centro"><option value=""></option><?php foreach($querycentro as $row){echo '<option value="'.$row->id_m_c.'">'.$row->name.'</option>';} ?></select></div><div class="col-md-3"><label class="control-label"><span style="color:red">*</span> Sala</label> <input type="text" id="sala"class="form-control saveSalaInfo" disabled /><p id="processing-sala"></p></div><div class="col-md-3"><label class="control-label" > Fecha De Ingreso</label><input type="text" id="fechaIng"  class="form-control saveSalaInfo date disNewInp" disabled /></div><div class="col-md-7"> <label class="control-label" > Diagnostico De Ingreso</label><input type="text" id="diagIng"  class="form-control saveSalaInfo disNewInp" disabled /> </div><div class="col-md-12"style="text-align:center"><i class="fa fa-check-circle"id="result-sala"style="color:green;display:none"></i></div><input type="hidden"value="0"id="what-to-do"><div class="col-md-12 move_left"style="background:#e6e6fa"><hr class="hr_ad"><h4 class="h4 his_med_title">I- Indicaciones Medicamentos</h4></div><form class="form-horizontal"id="submit-ord-med"method="post"><input type="hidden"name="historial_id"value="<?=$id_historial?>"> <input type="hidden"name="operator"value="<?=$user_id?>"> <input type="hidden"name="sala"id="copy-sala"> <input type="hidden"name="printing"value="1"> <input type="hidden"name="centro"value="0"> <input type="hidden"name="cantidad"value="0"> <input type="hidden"name="descuento"value="0"> <input type="hidden"name="id_em"value="0"> <input type="hidden"name="cobert"value="0"><div class="col-md-3"><div class="form-group"><label class="control-label"><span style="color:red">*</span> Medicamento</label> <select class="form-control select2"name="medicamento_ord_med"><option value=""></option><?php foreach($medicamentos as $row){ ?><option value="<?=$row->name?>"><?=$row->name?></option><?php } ?></select></div><div class="form-group"><label class="control-label"><span style="color:red">*</span> Presentacion</label> <select class="form-control select2"name="presentacion_ord_med"><option value=""hidden></option><?php foreach($presentacion as $row){echo '<option value="'.$row->name.'">'.$row->name.'</option>';} ?></select></div><div class="form-group"><label class="control-label"><span style="color:red">*</span> Frecuencia</label> <select class="form-control select2"name="frecuencia_ord_med"><option value=""hidden></option><?php foreach($frecuencia as $row){echo '<option value="'.$row->frecuency.'">'.$row->frecuency.'</option>';} ?></select></div><div class="form-group"><label class="control-label"><span style="color:red">*</span> Via</label> <select class="form-control select2"name="via_ord_med"id="via_ord_med"><option value=""hidden></option><?php foreach($via as $row){echo '<option value="'.$row->via.'">'.$row->via.'</option>';} ?></select> <span style="display:none"class="show-oyo"><select class="form-control select2"name="oyo_ord_med"><option value=""hidden></option><option>Ojo izquiedo</option><option>Ojo derecho</option><option>Ambos ojos</option></select> <span></div><div class="form-group"><label class="control-label">Nota</label> <textarea class="form-control reset-est"name="nota_ord_med"rows="6"></textarea></div></div><div class="col-md-1"title="Ingresar"><div class="btn-group"><button class="btn btn-dis-or-med btn-primary btn-xs"disabled id="add-all-ord-med"title="El campo sala debe ser lleno primero."type="submit"><i class="fa fa-angle-double-right"aria-hidden="true"></i></button></div></div></form><div class="col-md-8 doubleb"style="top:20px;height:550px;overflow-y:auto;background:#fff;box-shadow:0 0 0 1px #7f7f7f,0 0 0 2px #999,0 0 0 3px #b2b2b2"><div id="new_indication_ord_med"></div></div><div class="col-md-12"><hr class="hr_ad"></div><script>var typingTimer;centro,$("#centro").change(function(e){""==$(this).val()?($("#sala").prop("disabled",!0),$("#imprimirOrMed").hide()):0==$("#what-to-do").val()?$.ajax({url:"<?php echo base_url(); ?>saveHistorial/saveOrdMedSala",data:{sala:"",user_id:<?=$user_id?>,historial_id:<?=$id_historial?>,centro:$("#centro").val()},method:"POST",dataType:"JSON",success:function(e){$("#processing-sala").hide(),$("#sala").prop("disabled",!1),$("#what-to-do").val(1),$("#result-sala").show().text("Agregado con exito"),$("#copy-sala").val(e),$(".btn-dis-or-med").prop("disabled",!1)}}):1==$("#what-to-do").val()&&$.ajax({url:"<?php echo base_url(); ?>saveHistorial/editSala",data:{centro:$("#centro").val(),sala:$("#sala").val(),id:$("#copy-sala").val(),fecha_ingreso:$("#fechaIng").val(),diagno_ing:$("#diagIng").val()},method:"POST",success:function(e){$("#processing-sala").hide(),$("#sala").prop("disabled",!1),$("#result-sala").show().text(" Cambiado con exito"),$(".btn-dis-or-med").prop("disabled",!1)}})});var doneTypingInterval=1e3,$input=$(".saveSalaInfo");function doneTyping(){$("#processing-sala").fadeIn().html('<img  src="<?=base_url()?>assets/img/loading.gif" />'),""==$input.val().trim()?($("#result-sala").hide(),$("#processing-sala").hide(),$(".btn-dis-or-med").prop("disabled",!0),$("#imprimirOrMed").hide()):""!=$input.val().trim()&&$.ajax({url:"<?php echo base_url(); ?>saveHistorial/editSala",data:{centro:$("#centro").val(),sala:$("#sala").val(),id:$("#copy-sala").val(),fecha_ingreso:$("#fechaIng").val(),diagno_ing:$("#diagIng").val()},method:"POST",success:function(e){$("#processing-sala").hide(),$("#result-sala").show().text(" Cambiado con exito"),$(".btn-dis-or-med").prop("disabled",!1),$("#imprimirOrMed").show()}})}function allRecetasOrdMed(){$("#allRecetasOrdMed").fadeIn().html('<span class="load"> <img  width="40px" src="<?=base_url()?>assets/img/loading.gif" /></span>');var e=<?=$user_id?>,a=<?=$id_historial?>;$.ajax({url:"<?php echo base_url(); ?>saveHistorial/allRecetasOrdMed",data:{historial_id:a,user_id:e,area:"",printing:1},method:"POST",success:function(e){$("#new_indication_ord_med").html(e)},error:function(e,a,o){alert("An error occurred... Look at the console (F12 or Ctrl+Shift+I, Console tab) for more information!"),$("#new_indication_ord_med").html("<p>status code: "+e.status+"</p><p>errorThrown: "+o+"</p><p>jqXHR.responseText:</p><div>"+e.responseText+"</div>"),console.log("jqXHR:"),console.log(e),console.log("textStatus:"),console.log(a),console.log("errorThrown:"),console.log(o)}})}$input.on("keyup",function(){clearTimeout(typingTimer),typingTimer=setTimeout(doneTyping,doneTypingInterval)}),$input.on("keydown",function(){clearTimeout(typingTimer)}),$("#submit-ord-med").submit(function(e){e.preventDefault(),""==$("select[name=medicamento_ord_med]").val()||""==$("select[name=presentacion_ord_med]").val()||""==$("select[name=frecuencia_ord_med]").val()||""==$("select[name=via_ord_med]").val()?alert("Los campos con '*' son obligatorios para grabar una receta!"):($("#add-all-ord-med").prop("disabled",!0),$.ajax({url:"<?php echo base_url(); ?>saveHistorial/saveOrdenMedicaRecetas",method:"POST",data:new FormData(this),contentType:!1,cache:!1,processData:!1,success:function(e){$("#add-all-ord-med").prop("disabled",!1),$("#imprimirOrMed").show(),$(".reset-est").val(""),allRecetasOrdMed()}}))}),$(".select2").select2({tags:!0}),$("#via_ord_med").change(function(){"OFTALMICA"==$(this).val()?$(".show-oyo").show():$(".show-oyo").hide()}),$('.date').mask('00-00-0000', {placeholder: 'dd-mm-AAAA'}),$("#sala").on("keyup",(function(){""==$("#sala").val()?$(".disNewInp").prop("disabled",!0):$(".disNewInp").prop("disabled",!1)}))</script>