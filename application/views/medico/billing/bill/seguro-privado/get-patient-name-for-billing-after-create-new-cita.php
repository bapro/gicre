<style>.heading{text-align:left}</style><?php if($is_admin=="yes"){$cont="admin";}else{$cont="medico";}if($identificar=="privado"){$tarif="Doctor Tarifarios ";}else{$tarif="Centro Tarifarios";} ?><div class="col-sm-12 searchb showdown3"><br><form class="form-inline"><div class="form-group"><label>Fecha</label> <input class="form-control change-red"value="<?=date("d-m-Y")?>"id="fecha-edit"style="width:130px"><br><br></div></form></div><div class="col-sm-12 searchb showdown3"><h2 align="center"class="h2">FACTURA</h2><div style="overflow-x:auto"><table class="tab_logic table table-bordered table-condensed table-striped turf"id="turf"><thead><tr class="trback"><?php if($identificar=="privado"){if(empty($serv)){$display="style='display:none'";}else{$display="";} ?><th class="heading"><?php if(empty($serv)){echo "<span style='color:#B18904'><form method='post' action='".base_url()."admin_medico/import_rates_fac'>
	<input type='hidden' name='id_doc' value='$id_doc'/>
	<input type='hidden' name='id_seguro' value='$id_seguro'/>
	<input type='hidden' name='plan' value='$planOcentro'/>
	<input type='hidden' name='name' value='$name'/>
	<input type='submit' value='No hay tarifarios crear'/></form></span>";$disabled="disabled";$display="none";$disabled="disabled";$display="none";}else{echo $tarif;$disabled="";} ?></th><?php }else{if(empty($serv_centro)){$display="style='display:none'";}else{$display="";} ?><th class="heading"><?php if(empty($serv_centro)){echo "<span style='color:#B18904'>No hay servicios | <a  href='".base_url()."admin_medico/import_rates_fac_centro/$id_cm/$id_seguro/$name'>Crear</a></span>";$disabled="disabled";$display="none";}else{echo $tarif;$disabled="";} ?></th><?php } ?><th class="heading">Cantidad</th><th class="heading">Precio Unitario</th><th class="heading">Sub-Total</th><th class="heading">Descuento</th><th class="heading">Total Pagar Paciente</th><?php if($identificar=="privado"){if(empty($serv)){$display="style='display:none'";}else{$display="";} ?><td></td><?php }else{if(empty($serv_centro)){$display="style='display:none'";}else{$display="";} ?><td></td><?php } ?></tr></thead><tfoot><tr class="grand-total persist"style="background:#d5d370;font-size:18px"><th colspan="3">TOTALES</th><th>RD$ <span id="table-grand-total">0.00</span></th><th style="color:red">RD$ <span id="descuento-grand-total">0.00</span></th><th>RD$ <span id="tot-paciente-grand-total">0.00</span></th><th style="background:#fff"><?php if($identificar=="privado"){if(empty($serv)){$display="display:none";}else{$display="";} ?><button id="add_row"style="cursor:pointer;font-size:13px;color:#00f;background:#fff;<?=$display?>"type="button"disabled title="Añadir fila"><span class="glyphicon glyphicon-plus-sign"></span></button><?php }else{if(empty($serv_centro)){$display="display:none";}else{$display="";} ?><button id="add_row_c"style="cursor:pointer;font-size:13px;color:#00f;background:#fff;<?=$display?>"type="button"disabled title="Añadir fila"><span class="glyphicon glyphicon-plus-sign"></span></button><?php } ?></th></tr><tr><td colspan="7"id="delete_row"style="color:red;font-size:13px;display:none;cursor:pointer;background:#fff;text-align:right"title="Borrar fila con casilla marcada"><span class="glyphicon glyphicon-minus-sign"></span></td><td colspan="8"></td></tr></tfoot><tbody><tr class="change-red calculation visible"id="addr1"><td style="width:180px;display:block"><?php if($identificar=="privado"){ ?><select class="form-control select2 service option-seguro1"onchange="getSegName(this)"><option value=""hidden></option><?php foreach($serv as $s){ ?><option value="<?=$s->id_tarif?>"><?=$s->procedimiento?></option><?php } ?></select><?php }else{ ?><select class="form-control change-red option-centro1 select2 service"onchange="getSegNameCentro(this)"><option value=""hidden></option><?php foreach($serv_centro as $s){ ?><option value="<?=$s->id_c_taf?>"><?=$s->sub_groupo?>- (<?=$s->groupo?>)</option><?php } ?></select><?php } ?></td><td class="cantidad"><input class="form-control cantidad"value="1"tabindex="1"onkeypress="return validateQty(event)"></td><td class="precio"><div class="input-group"><span class="input-group-addon">RD$</span> <input class="form-control float precio"tabindex="2"onkeypress="return onlyfloat(event)"></div></td><td class="row-total"><div class="input-group"><span class="input-group-addon">RD$</span> <input class="form-control row-total"value="0.00"readonly> <input class="form-control total-pag-seg"value="0.00"type="hidden"></div></td><td class="descuento"><div class="input-group"><span class="input-group-addon">RD$</span> <input class="form-control float descuento"tabindex="4"onkeypress="return onlyfloat(event)"style="color:red"></div></td><td class="total-pag-pa"><div class="input-group"><span class="input-group-addon">RD$</span> <input class="form-control total-pag-pa"value="0.00"readonly tabindex="5"></div></td><td></td></tr><tr class="calculation visible"id="addr2"></tbody></table><div style="color:red"id="required_fac"></div></div></div><div class="col-sm-12 searchb showdown3"><br><div style="overflow-x:auto"><div class="col-sm-9"><input id="total-pagar-paciente"type="hidden"> <input id="descuento1"type="hidden"> <input id="total-pago-seguro"type="hidden"> <input id="sub-total"type="hidden"> <textarea class="form-control"id="comment"placeholder="Comentario"rows="10"></textarea><br></div><div class="col-sm-3"><button id="save_factura"style="margin-left:14px"type="button"class="btn btn-success"<?=$disabled?>><i class="fa fa-save"></i> Guardar</button></div></div></div><br><br><br><br><br><div class="loadf"></div><script src="https://code.jquery.com/jquery-2.2.0.min.js"></script><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/js/select2.min.js"></script><script src="//code.jquery.com/ui/1.11.3/jquery-ui.js"></script><script>function getSegName(e){$(".loadf").fadeIn().html('<span style="font-size:24px" class="glyphicon glyphicon-refresh glyphicon-refresh-animate load"></span>');$.ajax({type:"POST",url:"<?php echo site_url('factura/get_service_precio'); ?>",data:{id_mssm1:e.value,doctorid:"<?=$id_doc?>",id_centro:<?=$id_cm?>},success:function(t){$($(e).parents("tr")[0]).find("input.precio").val(t),recalc(),$(".loadf").hide(),$("#add_row").prop("disabled",!1)}})}function getSegNameCentro(e){$(".loadf").fadeIn().html('<span style="font-size:24px" class="glyphicon glyphicon-refresh glyphicon-refresh-animate load"></span>'),$.ajax({type:"POST",url:"<?php echo site_url('factura/get_service_precio_centro'); ?>",data:{id_mssm1:e.value},success:function(t){$($(e).parents("tr")[0]).find("input.precio").val(t),recalc(),$(".loadf").hide(),$("#add_row_c").prop("disabled",!1)}})}$("#fecha-edit").datepicker({dateFormat:"dd-mm-yy",maxDate:"-1d",beforeShow:function(){setTimeout(function(){$(".ui-datepicker").css("z-index",99999999999999)},0)}}),$("#check-if-is-as-medico").click(function(){}),Number.prototype.format=function(t,e){var o="\\d(?=(\\d{"+(e||3)+"})+"+(0<t?"\\.":"$")+")";return this.toFixed(Math.max(0,~~t)).replace(new RegExp(o,"g"),"$&,")};var numRows=2,ti=5;function isNumber(t){return!isNaN(parseFloat(t))&&isFinite(t)}function recalc(){var a=0;ss=0,dd=0,pp=0,$("#turf").find("tr").each(function(){var t=$(this).find("input.cantidad").val()*$(this).find("input.precio").val(),e=$(this).find("input.descuento").val(),o=t-e;$(this).find("input.total-pag-pa").val(o.toFixed(2)?o.toFixed(2):""),$(this).find("input.row-total").val(t.toFixed(2)?t.toFixed(2):""),a+=isNumber(t)?t:0,dd+=isNumber(e)?parseInt(e,10):0,pp+=isNumber(o)?o:0}),$("#table-grand-total").html(a.format(2)),$("#sub-total").val(a),$("#descuento-grand-total").html(dd.format(2)),$("#descuento1").val(dd),$("#tot-paciente-grand-total").html(pp.format(2)),$("#total-pagar-paciente").val(pp)}function addRow(){$("#add_row").prop("disabled",!0),$("#addr"+numRows).html("<td style='width:180px;display:block'><select class='service form-control select2 option-seguro2' onChange='getSegName(this);'></select></td><td class='cantidad'><input value='1' name='cantidad"+numRows+"' type='text' class='cantidad form-control'  tabindex='"+ti+++"' onkeypress='return validateQty(event);' /><input type='hidden' class='total-pag-seg form-control' value='0.00'/></td><td class='precio'><div class='input-group'><span class='input-group-addon'>RD$</span><input  name='precio"+numRows+"' type='text' class='precio form-control float'  tabindex='"+ti+++"' onkeypress='return onlyfloat(event);' /></div></td><td class='row-total'><div class='input-group'><span class='input-group-addon'>RD$</span><input type='text' class='row-total form-control' value='0.00' readonly /></div></td><td class='descuento'><div class='input-group'><span class='input-group-addon'>RD$</span><input style='color:red' name='descuento"+numRows+"' type='text' class='descuento form-control float'  tabindex='"+ti+++"'onkeypress='return onlyfloat(event);' /></div></td><td class='total-pag-pa'><div class='input-group'><span class='input-group-addon'>RD$</span><input  name='totalpagpa"+numRows+"' type='text' class='total-pag-pa form-control ' value='0.00' tabindex='"+ti+++"' readonly /></div></td><td><input type='checkbox' name='chkbox' class='remove'></td>");var t=$(".option-seguro1 > option").clone();$(".option-seguro2").append(t),$(".select2").select2(),$("#turf tr:last").after('<tr id="addr'+(numRows+1)+'" class="calculation visible"></tr>'),numRows++,$("#delete_row").slideDown()}function addRowC(){$("#add_row_c").prop("disabled",!0),$("#addr"+numRows).html("<td style='width:180px;display:block'><select class='service form-control select2 option-centro2' onChange='getSegNameCentro(this);'></select></td><td class='cantidad'><input value='1' name='cantidad"+numRows+"' type='text' class='cantidad form-control'  tabindex='"+ti+++"' onkeypress='return validateQty(event);' /><input type='hidden' class='total-pag-seg form-control' value='0.00'/></td><td class='precio'><div class='input-group'><span class='input-group-addon'>RD$</span><input  name='precio"+numRows+"' type='text' class='precio form-control float'  tabindex='"+ti+++"' onkeypress='return onlyfloat(event);' /></div></td><td class='row-total'><div class='input-group'><span class='input-group-addon'>RD$</span><input type='text' class='row-total form-control' value='0.00' readonly /></div></td><td class='descuento'><div class='input-group'><span class='input-group-addon'>RD$</span><input style='color:red' name='descuento"+numRows+"' type='text' class='descuento form-control float'  tabindex='"+ti+++"'onkeypress='return onlyfloat(event);' /></div></td><td class='total-pag-pa'><div class='input-group'><span class='input-group-addon'>RD$</span><input  name='totalpagpa"+numRows+"' type='text' class='total-pag-pa form-control ' value='0.00' tabindex='"+ti+++"' readonly /></div></td><td><input type='checkbox' name='chkbox' class='remove'></td>");var t=$(".option-centro1 > option").clone();$(".option-centro2").append(t),$(".select2").select2(),$("#turf tr:last").after('<tr id="addr'+(numRows+1)+'" class="calculation visible"></tr>'),numRows++,$("#delete_row").slideDown()}function delRow(){$('input[name="chkbox"]').each(function(){$(this).is(":checked")&&$(this).parents("tr").remove()}),$('input[name="chkbox"]').length<1&&$("#delete_row").slideUp()}function validateQty(t){var e=window.event?t.keyCode:t.which;return 8==t.keyCode||46==t.keyCode||37==t.keyCode||39==t.keyCode||!(e<48||57<e)}function onlyfloat(t){var e=(t=t||window.event).which?t.which:t.keyCode;return!(31<e&&(e<48||57<e))||46==t.which&&-1==$(".float").val().indexOf(".")}$(function(){$("#turf").on("click",".calculation",recalc),$("#turf").on("keyup blur",".form-control",recalc),$("#add_row").on("click",function(){addRow()}),$("#add_row_c").on("click",function(){addRowC()}),$("#delete_row").on("click",function(){delRow(),recalc()})}),$("#save_factura").on("click",function(t){var cant=$("input.cantidad").val(),prec=$("input.precio").val(),a=0,n=0;var servField = $('.service').val();var s="<?=$id_cm?>",c=$("#fecha-edit").val(),l=$("#sub-total").val(),i=$("#descuento1").val(),r=$("#total-pagar-paciente").val(),d=$("#comment").val(),ct="<?=$identificar?>",p=[],u=[],f=[],h=[],y=[],m=[],v=[];$(".service").each(function(){p.push($(this).val())}),$("input.cantidad").each(function(){u.push($(this).val())}),$("input.precio").each(function(){f.push($(this).val())}),$("input.row-total").each(function(){h.push($(this).val())}),$("input.total-pag-seg").each(function(){y.push($(this).val())}),$("input.descuento").each(function(){m.push($(this).val())}),$("input.total-pag-pa").each(function(){v.push($(this).val())}),$(".loadf").fadeIn().html('<span  class="glyphicon glyphicon-refresh glyphicon-refresh-animate load"></span>'),$.ajax({type:"POST",dataType:"json",url:"<?=base_url('factura/SaveBill')?>",data:{service:p,cantidad:u,preciouni:f,tsubtotal:l,totpagseg:"",totsubdesc:i,totpagpa:r,subtotal:h,totalpaseg:y,descuento:m,totpapat:v,seguro_medico:"<?=$id_seguro?>",patient_id:"<?=$id_p_a?>",medico:"<?=$id_doc?>",codigoprestado:"<?=$cod?>",fecha:c,id_apoint:"<?=$id_apoint?>",is_admin:"<?=$is_admin?>",numauto:a,autopor:n,comment:d,inserted_by:"<?=$name?>",area:"<?=$area?>",centro_medico:s,cant:cant,prec:prec,servField:servField},cache:!0,success:function(t){if(4==t.status)$(".loadf").html('<p class="alert alert-danger ">'+t.message+"</p>");else if(2==t.status)$(".loadf").html('<p class="alert alert-danger ">'+t.message+"</p>");else if(3==t.status)$("#required_fac").html('<p class="alert alert-danger ">'+t.message+'</p>').fadeIn("slow").delay(4e3).fadeOut("slow"),$(".change-red").css("border-color","red"),$(".change-red").find(".form-control").not(".descuento").css("border-color","red"),$(".loadf").fadeIn().html('');else{var e=t.status;window.location.href="<?php echo base_url(); ?><?=$cont?>/viewPrivateBill_/"+e+"/"+ct}},error:function(t,e,o){alert("An error occurred... Look at the console (F12 or Ctrl+Shift+I, Console tab) for more information!"),$(".loadf").html("<p>status code: "+t.status+"</p><p>errorThrown: "+o+"</p><p>jqXHR.responseText:</p><div>"+t.responseText+"</div>"),console.log("jqXHR:"),console.log(t),console.log("textStatus:"),console.log(e),console.log("errorThrown:"),console.log(o)}});return!1}),$(".select2").select2({language:{noResults:function(){return"No hay resultado"}}})</script>